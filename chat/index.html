<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<input id="nick" type="text" placeholder="nick">
<input id="message" type="text" placeholder="message">
<button id="send">Send</button>

<div id="message-body"></div>
</body>

<script>
    let nick = document.getElementById('nick');
    let message = document.getElementById('message');
    let send = document.getElementById('send');
    const url = 'http://students.a-level.com.ua:10012';
    send.addEventListener('click', () => {
        let request = new XMLHttpRequest();
        request.open("POST", url, true);
        request.send(JSON.stringify({func: "addMessage", nick: nick.value, message: message.value}));
    });


    let counter = 0;
    setInterval(() => {
        let res = null;
        let index = 0;
        let request = new XMLHttpRequest();
        request.open("POST", url, true);
        request.onreadystatechange = () => {
            if (request.readyState !== 4) {
                return;
            }
            if (request.status === 200) {
                let responseText = request.responseText;
                res = JSON.parse(responseText);
                index = res.nextMessageId;
                if (index !== counter) {
                    render(res.data.slice(counter, index));
                }
                counter = index;
            }
        };
        request.send(JSON.stringify({func: "getMessages", messageId: index}));
    }, 2000);

    let messageBody = document.getElementById('messageBody');

    function render(index) {
        console.log('массив в методе рендер', index);
        for (let i = 0; i < index.length; i++) {
            let div = document.createElement('div');
            let d = document.createElement('span');
            let m = document.createElement('span');

            div.innerText = '--------------------------------------';
            d.innerText = index[i].nick + '-';
            m.innerText = index[i].message;

            messageBody.insertBefore(m, messageBody.childNodes[0]);
            messageBody.insertBefore(d, messageBody.childNodes[0]);
            messageBody.insertBefore(div, messageBody.childNodes[0]);
        }
    }

</script>
</html>